# Live2D 语音聊天功能

## 功能概述

本应用为 Easy Live2D Playground 添加了完整的语音聊天功能，支持与 Live2D 模型进行实时语音对话。

## 主要功能

### 1. 文本聊天 💬
- **实时消息发送**: 支持文本输入和发送
- **消息历史**: 显示所有聊天记录，区分用户和AI消息
- **自动滚动**: 新消息自动滚动到可见区域
- **时间戳**: 每条消息显示发送时间

### 2. 语音识别 🎤
- **语音转文字**: 支持中文和英文语音识别
- **实时识别**: 边说边识别，显示临时结果
- **语言切换**: 可在中文和英文之间切换
- **错误处理**: 完善的错误提示和恢复机制

### 3. 语音合成 🔊
- **文字转语音**: AI回复自动转换为语音
- **多语言支持**: 支持中文和英文语音合成
- **语速调节**: 可调节语音播放速度
- **音量控制**: 支持音量大小调节

### 4. Live2D嘴型同步 😊
- **实时同步**: 语音播放时模型嘴型实时同步
- **参数调节**: 支持嘴型同步的平滑度和敏感度调节
- **音频分析**: 基于音频频率分析实现自然嘴型

### 5. 聊天历史管理 📋
- **本地存储**: 自动保存聊天记录到本地
- **历史统计**: 显示消息数量、时间范围等统计信息
- **导出功能**: 支持将聊天记录导出为JSON文件
- **导入功能**: 支持从JSON文件导入聊天记录
- **清空功能**: 可清空所有历史记录

## 技术架构

### 前端技术栈
- **Vue 3**: 现代化前端框架
- **TypeScript**: 类型安全的JavaScript
- **Pinia**: 状态管理
- **Web Speech API**: 语音识别和合成
- **Web Audio API**: 音频分析和处理

### 核心组件
- **ChatInterface**: 主要聊天界面组件
- **VoiceControls**: 语音控制组件
- **ChatMessage**: 消息显示组件
- **ChatHistory**: 历史记录管理组件
- **ErrorNotification**: 错误提示组件

### 工具类
- **SpeechService**: 语音识别和合成服务
- **LipSyncService**: Live2D嘴型同步服务
- **ChatStorage**: 聊天记录存储管理
- **ErrorHandler**: 错误处理和用户提示

## 使用说明

### 基本使用
1. **启动应用**: 运行 `pnpm dev` 启动开发服务器
2. **文本聊天**: 在输入框中输入文字，按回车或点击发送
3. **语音输入**: 点击"语音输入"按钮开始录音，说话后自动识别
4. **语音回复**: AI回复会自动播放语音并同步嘴型

### 高级功能
1. **语言切换**: 点击语言按钮切换中英文识别
2. **历史管理**: 点击"历史记录"查看和管理聊天记录
3. **导出导入**: 使用导出/导入功能保存和恢复聊天记录

### 浏览器兼容性
- **推荐浏览器**: Chrome, Edge (完整语音功能)
- **部分支持**: Firefox (语音合成功能)
- **不支持**: Safari (需要用户交互才能播放音频)

## 配置选项

### 语音设置
```typescript
interface VoiceSettings {
  lang: string        // 语言 'zh-CN' | 'en-US'
  pitch: number       // 音调 0.1 - 2.0
  rate: number        // 语速 0.1 - 2.0
  volume: number      // 音量 0.0 - 1.0
}
```

### 嘴型同步设置
```typescript
interface LipSyncConfig {
  smoothness: number  // 平滑度 0.0 - 1.0
  sensitivity: number // 敏感度 0.0 - 1.0
  updateInterval: number // 更新间隔(ms)
}
```

## 性能优化

### 语音识别优化
- 使用连续识别模式，减少启动延迟
- 支持临时结果，提高响应速度
- 错误重试机制，提高稳定性

### 嘴型同步优化
- 使用requestAnimationFrame实现60fps更新
- 音频数据平滑处理，避免嘴型抖动
- 智能参数映射，实现自然嘴型变化

### 内存管理
- 及时清理音频上下文和事件监听器
- 合理使用防抖和节流
- 聊天记录分页加载，避免内存溢出

## 错误处理

### 语音识别错误
- 麦克风权限被拒绝
- 网络连接失败
- 未检测到语音输入
- 浏览器不支持语音识别

### 语音合成错误
- 语音合成引擎不可用
- 文本内容无法合成
- 音频播放失败

### Live2D集成错误
- 模型加载失败
- 嘴型参数不存在
- 音频分析失败

## 扩展建议

### 功能扩展
1. **多模型支持**: 支持切换不同的Live2D模型
2. **情感识别**: 根据语音情感调整模型表情
3. **语音转文字编辑**: 支持修改识别结果
4. **语音保存**: 保存语音消息到本地

### 技术扩展
1. **AI对话**: 集成真正的AI对话API
2. **实时翻译**: 支持多语言实时翻译
3. **语音克隆**: 自定义语音合成声音
4. **云端同步**: 聊天记录云端同步

## 开发注意事项

### 安全考虑
- 麦克风权限需要用户明确授权
- 语音数据不上传到第三方服务
- 本地存储数据加密保护

### 用户体验
- 提供清晰的操作引导
- 完善的错误提示和恢复机制
- 响应式设计，适配各种屏幕尺寸

### 性能考虑
- 避免频繁DOM操作
- 合理使用Web Worker处理音频
- 及时释放不再使用的资源

## 结语

这个语音聊天功能为Live2D模型带来了生动的交互体验，用户可以通过语音与模型进行自然对话，同时模型会根据语音内容实时同步嘴型，创造出更加真实的交互感受。